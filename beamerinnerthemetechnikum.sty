% Beamer Inner Theme Technikum
% Defines inner elements: title page, lists, blocks, etc.
\mode<presentation>

% =============================================================================
% SPACING CONFIGURATION
% =============================================================================
% All spacing values use flexible glue: {natural} plus {stretch} minus {shrink}
% This allows LaTeX to optimize layout while maintaining visual consistency

\makeatletter

% ---- Global paragraph spacing ----
\setlength{\parskip}{0.5em plus 0.2em minus 0.3em}  % Space between paragraphs
\setlength{\parindent}{0pt}                          % No paragraph indentation

% ---- List spacing (itemize/enumerate) ----
% Default spacing for all lists
\setlength{\itemsep}{0.3em plus 0.2em minus 0.1em}  % Space between items

% Level-specific list spacing
\def\@listi{%
    \leftmargin\leftmargini
    \parsep 0pt                                      % No extra space between paragraphs in items
    \topsep 0.3em plus 0.2em minus 0.1em            % Space before/after list
    \itemsep 0.4em plus 0.2em minus 0.2em           % Space between 1st level items
}
\def\@listii{%
    \leftmargin\leftmarginii
    \parsep 0pt
    \topsep 0.2em                                    % Space before/after nested list
    \itemsep 0.5em plus 0.3em minus 0.3em           % Space between 2nd level items (increased)
}
\def\@listiii{%
    \leftmargin\leftmarginiii
    \parsep 0pt
    \topsep 0.2em
    \itemsep 0.4em plus 0.2em minus 0.2em           % Space between 3rd level items
}

% Activate the list spacing definitions
\let\@listI\@listi
\@listi

% Space before nested lists begin
\setbeamertemplate{itemize/enumerate body begin}{}
\setbeamertemplate{itemize/enumerate subbody begin}{\vspace{0.2em}}     % Before 2nd level
\setbeamertemplate{itemize/enumerate subsubbody begin}{\vspace{0.2em}}  % Before 3rd level

% ---- Block environment spacing ----
% Space inside and around blocks (definition, theorem, example, etc.)
\addtobeamertemplate{block begin}{}{%
    \setlength{\parskip}{0.5em plus 0.2em minus 0.3em}      % Between paragraphs inside blocks
    \setlength{\itemsep}{0.4em plus 0.2em minus 0.2em}      % Between items inside blocks
    % Override list spacing for lists inside blocks
    \def\@listi{%
        \leftmargin\leftmargini
        \parsep 0pt
        \topsep 0.3em plus 0.2em minus 0.1em
        \itemsep 0.6em plus 0.3em minus 0.4em               % 1st level in blocks
    }%
    \def\@listii{%
        \leftmargin\leftmarginii
        \parsep 0pt
        \topsep 0.2em
        \itemsep 0.6em plus 0.3em minus 0.4em               % 2nd level in blocks
    }%
    \def\@listiii{%
        \leftmargin\leftmarginiii
        \parsep 0pt
        \topsep 0.2em
        \itemsep 0.5em plus 0.2em minus 0.3em               % 3rd level in blocks
    }%
}
\addtobeamertemplate{block end}{}{%
    \vspace{0.5em plus 0.2em minus 0.3em}                   % After blocks
}

% ---- Frame margins ----
\setbeamersize{text margin left=1em}   % Left margin
\setbeamersize{text margin right=1em}  % Right margin

% =============================================================================
% ITEMIZE BULLET SYMBOLS
% =============================================================================

\setbeamertemplate{itemize item}{%
    \usebeamercolor{itemize item}%
    \begin{tikzpicture}[remember picture, overlay]%
        \node [fill=fg, regular polygon, regular polygon sides=5, minimum size=0.6em, yshift=0.35em, xshift=-0.4ex, rotate=-90, anchor=center, inner sep=0pt] {};%
    \end{tikzpicture}%
}

\setbeamertemplate{itemize subitem}{%
    \usebeamercolor{itemize subitem}%
    \begin{tikzpicture}[remember picture, overlay]%
        \node [fill=fg, regular polygon, regular polygon sides=4, minimum size=0.65em, yshift=0.35em, xshift=-0.4ex, rotate=-90, anchor=center, inner sep=0pt] {};%
    \end{tikzpicture}%
}

\setbeamertemplate{itemize subsubitem}{%
    \usebeamercolor{itemize subsubitem}%
    \begin{tikzpicture}[remember picture, overlay]%
        \node [fill=fg, regular polygon, regular polygon sides=3, minimum size=0.675em, yshift=0.35em, xshift=-0.4ex, rotate=-90, anchor=center, inner sep=0pt] {};%
    \end{tikzpicture}%
}

% =============================================================================
% CUSTOM COMMANDS
% =============================================================================

% Custom command for email
\newcommand{\email}[1]{\def\insertemail{#1}}
\newcommand{\insertemail}{}  % Initialize empty

% Custom command for title page background
\newcommand{\inserttitlebackground}{}  % Initialize empty

% =============================================================================
% TITLE PAGE BACKGROUND PROCESSING
% =============================================================================

% Process background option (set by main theme)
\@ifundefined{beamer@technikum@background}{}{%
    \edef\temp{\beamer@technikum@background}%
    \checkbg{noir}{noir.jpg}%
    \checkbg{noir-bridge}{noir-bridge.jpg}%
    \checkbg{noir-bridge-color}{noir-bridge-color.jpg}%
    \checkbg{light}{light.jpg}%
    \checkbg{abstract}{abstract.png}%
    \checkbg{cyber}{cyber.jpg}%
    % If no preset matched, use the value as a direct path
    \ifx\inserttitlebackground\@empty
        \expandafter\def\expandafter\inserttitlebackground\expandafter{\beamer@technikum@background}%
    \fi
}

% =============================================================================
% TITLE PAGE TEMPLATES
% =============================================================================

% Load common title page definitions (shared dimensions and styles)
\input{title/common.def}

% Load title page variants
\input{title/general.def}
\input{title/centered.def}
\input{title/split.def}

% Set the chosen variant as the active title page
\ifx\beamer@technikum@title\@empty
    \setbeamertemplate{title page}[general]
\else
    \expandafter\setbeamertemplate\expandafter{title page}[\beamer@technikum@title]
\fi

% =============================================================================
% TITLE PAGE FRAME NUMBERING
% =============================================================================
% Automatically exclude title page from frame numbering
% The title page frame will be numbered 0, and the next frame will be 1
\AtBeginDocument{%
    \addtobeamertemplate{title page}{}{\setcounter{framenumber}{0}}%
}

% =============================================================================
% FRAME TITLE / SUBTITLE
% =============================================================================
% Create a helper command that returns frametitle or section
\newcommand{\insertframetitleorsection}{%
    \@ifundefined{beamer@frametitle}{%
        \insertsectionhead%
    }{%
        \ifx\beamer@frametitle\@empty%
            \insertsectionhead%
        \else%
            \beamer@frametitle%
        \fi%
    }%
}

% Create a helper command that returns framesubtitle or subsection
\newcommand{\insertframesubtitleorsection}{%
    \@ifundefined{beamer@shortframesubtitle}{%
        \insertsubsectionhead%
    }{%
        \ifx\beamer@shortframesubtitle\@empty%
            \insertsubsectionhead%
        \else%
            \beamer@shortframesubtitle%
        \fi%
    }%
}

\makeatother

\mode<all>